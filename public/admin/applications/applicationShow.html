<div layout="row">
    <div flex-gt-sm></div>
    <div layout-padding flex-gt-sm="60" flex>
        <login-prompt user="user"></login-prompt>
        <unauthorized user="user" authorized="authorized"></unauthorized>

        <div ng-if="user && authorized && gotApp">
            <md-card>
                <md-card-title>
                    <md-card-title-text layout="column" layout-align="center center">
                        <span class="md-headline wrap-title">Status</span>
                        <br>
                        <span class="md-headline wrap-title" ng-class="{'mod-app-under-review': app.status === 'Under Review',
                            'mod-app-awaiting-votes': app.status === 'Awaiting Votes', 'mod-app-accepted': app.status === 'Accepted',
                            'mod-app-rejected': app.status === 'Rejected'}">{{app.status}}</span>
                    </md-card-title-text>
                </md-card-title>
            </md-card>
            <h1 class="md-display-2">{{app.authour.name}}'s Moderator Application</h1>
            <p md-colors="{color: 'red-600'}">* Required</p>
            <br>
            <h1 class="md-headline">Name</h1>
            <p class="md-subhead" ng-hide="!app.name">{{app.name}}</p>
            <p class="md-subhead" md-colors="{color: 'grey-500'}" ng-show="!app.name">No information given</p>
            <md-divider></md-divider>
            <h1 class="md-headline">Gender</h1>
            <p class="md-subhead" ng-hide="!app.gender">{{app.gender}}</p>
            <p class="md-subhead" md-colors="{color: 'grey-500'}" ng-show="!app.gender">No information given</p>
            <md-divider></md-divider>
            <h1 class="md-headline">Age</h1>
            <p class="md-subhead" ng-hide="!app.age">{{app.age}}</p>
            <p class="md-subhead" md-colors="{color: 'grey-500'}" ng-show="!app.age">No information given</p>
            <md-divider></md-divider>
            <h1 class="md-headline">Location</h1>
            <p class="md-subhead" ng-hide="!app.location">{{app.location}}</p>
            <p class="md-subhead" md-colors="{color: 'grey-500'}" ng-show="!app.location">No information given</p>
            <md-divider></md-divider>
            <h1 class="md-headline">Occupation</h1>
            <p class="md-subhead" ng-hide="!app.occupation">{{app.occupation}}</p>
            <p class="md-subhead" md-colors="{color: 'grey-500'}" ng-show="!app.occupation">No information given</p>
            <md-divider></md-divider>
            <h1 class="md-headline">Time Spent Playing Garry's Mod</h1>
            <p class="md-subhead" ng-hide="!app.timePlayedGmod">{{app.timePlayedGmod}}</p>
            <p class="md-subhead" md-colors="{color: 'grey-500'}" ng-show="!app.timePlayedGmod">No information given</p>
            <md-divider></md-divider>
            <h1 class="md-headline">How You Found Us</h1>
            <p class="md-subhead" ng-hide="!app.howYouFoundUs">{{app.howYouFoundUs}}</p>
            <p class="md-subhead" md-colors="{color: 'grey-500'}" ng-show="!app.howYouFoundUs">No information given</p>
            <md-divider></md-divider>
            <h1 class="md-headline">ULX Experience <span md-colors="{color: 'red-600'}">*</span></h1>
            <p class="md-subhead" ng-hide="!app.ulxExperience">{{app.ulxExperience}}</p>
            <p class="md-subhead" md-colors="{color: 'grey-500'}" ng-show="!app.ulxExperience">No information given</p>
            <md-divider></md-divider>
            <h1 class="md-headline">Leadership Experience <span md-colors="{color: 'red-600'}">*</span></h1>
            <p class="md-subhead" ng-hide="!app.leadershipExperience">{{app.leadershipExperience}}</p>
            <p class="md-subhead" md-colors="{color: 'grey-500'}" ng-show="!app.leadershipExperience">No information given</p>
            <md-divider></md-divider>
            <h1 class="md-headline">Garry's Mod Leadership Experience <span md-colors="{color: 'red-600'}">*</span></h1>
            <p class="md-subhead" ng-hide="!app.gmodLeadershipExperience">{{app.gmodLeadershipExperience}}</p>
            <p class="md-subhead" md-colors="{color: 'grey-500'}" ng-show="!app.gmodLeadershipExperience">No information given</p>
            <md-divider></md-divider>
            <h1 class="md-headline">Willing to add us on Steam <span md-colors="{color: 'red-600'}">*</span></h1>
            <p class="md-subhead" ng-if="app.willingToAddUsOnSteam">Yes</p>
            <p class="md-subhead" md-colors="{color: 'warn-500'}" ng-if="!app.willingToAddUsOnSteam">No</p>
            <md-divider></md-divider>
            <h1 class="md-headline">Why We Should Accept You <span md-colors="{color: 'red-600'}">*</span></h1>
            <p class="md-subhead" ng-hide="!app.whyWeShouldAccept">{{app.whyWeShouldAccept}}</p>
            <p class="md-subhead" md-colors="{color: 'grey-500'}" ng-show="!app.whyWeShouldAccept">No information given</p>
            <md-divider></md-divider>
            <h1 class="md-headline">Additional Information</h1>
            <p class="md-subhead" ng-hide="!app.additionalInfo">{{app.additionalInfo}}</p>
            <p class="md-subhead" md-colors="{color: 'grey-500'}" ng-show="!app.additionalInfo">No information given</p>
            <md-divider></md-divider>
            <div layout="column" layout-align="center center" layout-fill layout-padding layout-margin flex ng-if="!gotApp">
                <md-progress-circular class="md-accent"></md-progress-circular>
            </div>

            <!-- Comments -->
            <md-tabs md-align-tabs="bottom" md-stretch-tabs="always" md-dynamic-height ng-show="comments[0]._id">
                <md-tab label="{{label}}" ng-click="getComments(label)" ng-repeat="label in commentLabels">
                    <md-subheader class="md-accent md-no-sticky">Staff Opinions</md-subheader>
                    <div layout="column" layout-align="center center" layout-fill layout-padding layout-margin ng-hide="gotComments">
                        <md-progress-circular class="md-accent"></md-progress-circular>
                    </div>
                    <md-card ng-repeat="comment in comments">
                        <md-card-title>
                            <md-card-title-media style="margin-right: 15px;" layout="row" layout-align="center center">
                                <img ng-src="{{comment.authour.avatarMedium}}" alt="" class="md-media card-media md-avatar circle" style="height: auto !important;">
                            </md-card-title-media>
                            <md-card-title-text>
                                <a ng-href="/user/{{comment.authour._id}}" class="md-title wrap-content md-accent md-hue-1">{{comment.authour.name}}</a>
                                <span class="md-subhead" am-time-ago="comment.createdAt"></span>
                            </md-card-title-text>
                        </md-card-title>
                        <md-card-content>
                            <p class="wrap-content" ng-hide="editingComment && editingCommentId === comment._id" ng-bind-html="comment.comment | htmlLinky"></p>
                            <md-input-container class="md-block" ng-if="editingComment && editingCommentId === comment._id">
                                <label>Comment</label>
                                <textarea class="md-accent" ng-model="comment.comment" ng-disabled="!user" md-maxlength="1000"></textarea>
                            </md-input-container>
                        </md-card-content>
                        <md-card-actions layout="row" layout-align="end center">
                            <div layout="row" flex ng-if="comment.editedBy">
                                <md-icon class="icon-left-of-text" md-colors="{color: 'amber-500'}">access_time</md-icon>
                                    <span class="md-subhead">Edited by
                                        <a ng-href="/user/{{comment.editedBy._id}}" class="md-accent">{{comment.editedBy.name}}</a>
                                        <span class="md-subhead" am-time-ago="comment.editedAt"></span>
                                    </span>
                                <span flex></span>
                            </div>
                            <div ng-if="user._id === comment.authour._id">
                                <md-button class="md-icon-button md-accent" ng-hide="editingComment && editingCommentId === comment._id" ng-click="toggleEditingComment(comment._id)">
                                    <md-icon>edit</md-icon>
                                    <md-tooltip>Edit comment</md-tooltip>
                                </md-button>
                                <md-button class="md-icon-button md-accent" ng-hide="editingComment && editingCommentId === comment._id" ng-click="confirmDeleteComment(comment._id)">
                                    <md-icon>delete</md-icon>
                                    <md-tooltip>Delete comment</md-tooltip>
                                </md-button>
                                <md-button class="md-accent" ng-show="editingComment && editingCommentId === comment._id"
                                           ng-click="toggleEditingComment(comment._id)">Cancel</md-button>
                                <md-button class="md-raised md-accent" ng-show="editingComment && editingCommentId === comment._id"
                                           ng-click="updateComment(comment)" ng-disabled="!comment.comment">Update</md-button>
                            </div>
                        </md-card-actions>
                    </md-card>
                </md-tab>
            </md-tabs>

            <!-- Comment Form -->
            <form>
                <md-input-container layout="row">
                    <div flex>
                        <label>Comment</label>
                        <textarea ng-model="newComment.comment" md-maxlength="1000"></textarea>
                    </div>
                    <md-button class="md-fab md-mini md-primary" ng-disabled="!newComment.comment" ng-click="createComment()">
                        <md-icon>send</md-icon>
                        <md-tooltip>Post Comment</md-tooltip>
                    </md-button>
                    <div class="hint">Post your opinion of this application</div>
                </md-input-container>
            </form>
        </div>
    </div>
    <div flex-gt-sm></div>
</div>

<!-- Delete Comment Dialog Confirm -->
<div style="visibility: hidden">
    <div class="md-dialog-container" id="deleteComment">
        <md-dialog aria-label="Delete Comment">
            <md-dialog-content class="md-dialog-content">
                <p class="md-headline">Delete this comment forever?</p>
                <p class="md-subhead">You won't be able to undo this!</p>
            </md-dialog-content>
            <md-dialog-actions>
                <md-button class="md-primary" ng-click="closeDialog()">Cancel</md-button>
                <md-button class="md-primary md-raised" ng-click="deleteComment()">Delete</md-button>
            </md-dialog-actions>
        </md-dialog>
    </div>
</div>